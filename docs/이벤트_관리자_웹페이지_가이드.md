# 인간실험 (Human Experiment) – 이벤트 생성·관리자 웹페이지 가이드

현재 프로젝트 구조를 기준으로 **이벤트 생성·관리자 웹페이지**에 필요한 요소와 구현 방법을 정리했습니다.

---

## 0. 현재 프로젝트 구현 현황

### 0.1 파일 구조

| 경로 | 역할 |
|------|------|
| `index.html` | LIFF 미니앱 단일 페이지: 홈·게임·결과·상점·트렌드·지갑·설정 등 |
| `js/data.js` | 시나리오 정의 (`scenarios` 객체) |
| `js/api.js` | API 모듈 (baseURL, getUserInfo, getScenarios, startGame, submitAnswer, completeGame, getEventResult 등) |
| `js/app.js` | 앱 초기화 (initApp, initLIFF) |
| `js/ui.js` | UI·카운트다운·상점·트렌드·설정·다국어 등 |
| `js/game.js` | 게임 플로우 (startGame, nextQuestion, 결과 처리) |
| `js/liff-auth.js` | LIFF 초기화·프로필 |
| `js/kaia-wallet.js` | Kaia 지갑 연동 |
| `js/ad-reward.js` | 광고 시청 리워드(티켓) |
| `css/style.css` | 스타일 |

### 0.2 시나리오 데이터 (js/data.js)

- **정의된 시나리오 ID**: `wedding`, `blind-date`, `bbq`
- **각 시나리오 필드**: `name`, `emoji`, `bannerImage`, `contextTitle`, `contextSubtitle`, `questions[]`
- **질문 구조**: `q`, `options[]`, `correct` (정답 인덱스)

### 0.3 미니앱 화면 구성 (index.html)

- **홈**: 상단 유저 스탯(캐시·리워드 포인트·티켓), 배너 슬라이더, **오늘의 시나리오**(wedding / blind-date / bbq 카드), **무료 티켓 받기**(광고 3회), **다음 시나리오 예고**(준비중 카드 2개)
- **게임 화면**: 타이머, 컨텍스트 오버레이, 진행률, 질문/선택지, 다음 질문
- **결과 화면**: 점수·순위·리워드·문제별 결과·트렌드 보드 링크
- **기타**: 상점, 트렌드, 지갑(Kaia), 설정(알림·다국어·이용약관 등)

### 0.4 이벤트·API 현황

- **오늘의 시나리오**: `index.html`에 카드 3개가 **하드코딩**되어 있음 (시나리오 ID, 배너, 리워드 50 USDT, 10분, 10문제, 티켓 1개).
- **다음 시나리오 예고**: "회사 회식", "부모님 댁 방문" 등 제목·배너가 **하드코딩**되어 있으며, `data.js`에는 아직 해당 시나리오가 없음.
- **카운트다운**: `js/ui.js`의 `startCountdowns()`에서 **고정값**(2시간 50분)으로 `weddingCountdown`, `blindDateCountdown`, `bbqCountdown`을 갱신. 서버 `endTime` 미연동.
- **API**: `js/api.js`의 `baseURL: 'https://api.popularhuman.com'`만 설정되어 있고, 나머지 호출은 **주석 처리**되어 있으며 유저 정보·시나리오·게임 시작·결과 등은 **로컬/목업**으로 동작.

관리자 페이지와 백엔드가 도입되면, **이벤트 목록 API**를 통해 오늘의 시나리오·다음 시나리오 예고를 **동적으로** 채우고, 카운트다운은 이벤트별 `endAt` 기준으로 계산하도록 변경하면 됩니다.

---

## 1. 현재 구조에서의 "이벤트" 의미

- **시나리오(Scenario)**: 퀴즈 내용 자체. 현재 `js/data.js`에 정의된 ID: `wedding`(친구의 결혼식), `blind-date`(처음 하는 소개팅), `bbq`(바베큐 굽기). 각 시나리오는 `name`, `emoji`, `bannerImage`, `contextTitle`, `contextSubtitle`, `questions[]`(질문/선택지/정답) 구조.
- **이벤트(Event)**: 특정 **시나리오를 특정 시간대에 오픈**한 회차  
  - 예: "친구의 결혼식 – 2025년 2월 16일 12:00 ~ 15:00"  
  - 리워드(USDT), 플레이 제한시간, 필요 티켓, 참여 가능/준비중 상태 등이 이벤트 단위로 결정됨

관리자 페이지는 **이벤트(시나리오 + 일시·설정)** 를 생성·수정·삭제·조회하는 용도로 보면 됩니다.

---

## 2. 관리자 페이지에서 필요한 기능

| 구분 | 기능 | 설명 |
|------|------|------|
| **이벤트 목록** | 조회·필터 | 진행 중/예정/종료 이벤트 목록, 날짜·시나리오별 필터 |
| **이벤트 생성** | 새 이벤트 만들기 | 시나리오 선택, 시작/종료 일시, 리워드(USDT), 제한시간(분), 필요 티켓 등 입력 |
| **이벤트 수정** | 기존 이벤트 편집 | 일시·리워드·설정 변경 (진행 전/중에 따라 제한 가능) |
| **이벤트 삭제/비활성화** | 취소 또는 숨김 | 삭제 또는 "취소" 상태로 표시 |
| **시나리오 관리** (선택) | 문제/선택지 관리 | 새 시나리오 추가 또는 기존 시나리오(질문·정답) 수정 |

우선 **이벤트 CRUD(생성/조회/수정/삭제)** 에 집중하고, 시나리오 관리는 2단계로 두는 것을 권장합니다.

---

## 3. 필요한 기술 요소

### 3.1 백엔드(API)

현재 `js/api.js`에는 `baseURL: 'https://api.popularhuman.com'`만 설정되어 있고, `getUserInfo`, `getScenarios`, `startGame`, `submitAnswer`, `completeGame`, `getEventResult` 등은 **주석 처리된 fetch 예시 + 로컬/목업**으로만 동작합니다. 관리자 페이지와 미니앱이 **같은 이벤트 데이터**를 쓰려면 이 주소를 사용하는 실제 백엔드가 필요합니다.

- **관리자 전용 API 예시**
  - `GET  /admin/events` – 이벤트 목록 (필터: 날짜, 상태)
  - `GET  /admin/events/:id` – 이벤트 상세
  - `POST /admin/events` – 이벤트 생성
  - `PUT  /admin/events/:id` – 이벤트 수정
  - `DELETE /admin/events/:id` – 이벤트 삭제 또는 비활성화
- **시나리오 목록**  
  - 미니앱에서 쓰는 시나리오 목록을 그대로 쓰면 됨: `GET /scenarios` 또는 현재처럼 정적 `scenarios` 목록을 관리자 쪽에서 참조

백엔드가 아직 없다면:
- Node.js(Express/Fastify), Python(Flask/FastAPI), Firebase/Firestore 등 중 하나로 **이벤트 CRUD API**를 먼저 만든 뒤, 관리자 웹은 이 API만 호출하도록 구현하면 됩니다.

### 3.2 이벤트 데이터 구조(예시)

관리자/백엔드에서 다룰 **이벤트** 스키마 예시는 아래와 같습니다.

```json
{
  "id": "evt_abc123",
  "scenarioId": "wedding",
  "title": "친구의 결혼식",
  "startAt": "2025-02-16T12:00:00Z",
  "endAt": "2025-02-16T15:00:00Z",
  "rewardUsdt": 50,
  "playTimeMinutes": 10,
  "requiredTickets": 1,
  "questionCount": 10,
  "status": "scheduled",
  "bannerImageUrl": "wedding_banner.png",
  "createdAt": "2025-02-10T00:00:00Z",
  "updatedAt": "2025-02-10T00:00:00Z"
}
```

- `status`: `draft` | `scheduled` | `live` | `ended` | `cancelled`  
- `scenarioId`: `data.js`의 키와 동일하게 두면 미니앱과 일치합니다.

### 3.3 유저 재화 필드 (API 설계 시)

미니앱에서 **게임 재화**는 다음 필드명을 사용합니다. 서버 API 설계 시 동일하게 두면 연동이 쉽습니다.

| 필드 | 설명 | 비고 |
|------|------|------|
| `cash` | 보유 캐시 (인앱 구매·리워드 등) | 과거 `coins` 대신 **cash** 사용. 실제 지갑 토큰(USDT, KAIA)과 구분 |
| `rewardPoints` | 리워드 포인트 | |
| `tickets` | 보유 티켓 | |
| `tokenBalance` | 온체인 토큰 잔액 | `{ usdt, kaia }` — 지갑(Kaia) 연동용 |
| `claimable` | 클레임 가능 수량 | `{ usdt, kaia }` |

이벤트 종료 후 결과 API에서 승자에게 지급하는 앱 재화는 `earnedCash`(숫자)로 내려주면 됩니다.

### 3.4 관리자 인증

- 관리자 페이지는 **일반 사용자(LIFF 유저)에게 노출되면 안 됨**
- 구현 방법 예:
  - **백엔드 세션 + 로그인 폼**: ID/비밀번호 또는 이메일 로그인 후 세션 쿠키로 `/admin/*` API 호출
  - **간단 비밀번호**: 관리자 전용 URL + 단일 비밀번호로 진입 (프로토타입용)
  - **OAuth/Google 등**: 운영팀 계정만 허용

---

## 4. 관리자 웹페이지 구현 방법

### 4.1 배치 위치

- **같은 저장소 안**에 두는 경우:  
  - 예: `PopularHuman/admin/` 폴더에 관리자용 HTML/JS/CSS를 두고,  
  - `https://your-domain.com/admin/` 또는 `https://admin.popularhuman.com` 에 배포
- **별 도메인/서브도메인**으로 분리하면 보안·권한 관리하기 좋습니다.

### 4.2 기술 스택 선택

| 방식 | 장점 | 단점 |
|------|------|------|
| **순수 HTML + JS + CSS** | 현재 미니앱과 동일, 빌드 없음 | SPA처럼 만들면 코드가 길어짐 |
| **React / Vue / Svelte** | 폼·목록·상태 관리 편함, 재사용 컴포넌트 | 빌드 설정 필요 |
| **관리자 템플릿(Admin LTE 등)** | 로그인·테이블·폼 UI 빠르게 구성 | 디자인/의존성 맞춤 필요 |

현재 프로젝트가 **빌드 도구 없이 HTML + JS**이므로, **빠르게 시작**하려면 동일하게 **단일 HTML + JS**로 목록/등록/수정 화면을 만들고, 백엔드 API가 준비되면 `fetch`로 연동하는 방식이 자연스럽습니다.

### 4.3 구현 순서 제안

1. **백엔드**
   - 이벤트 테이블(또는 컬렉션) 설계
   - `GET/POST/PUT/DELETE /admin/events` 구현
   - 관리자 인증(세션 또는 토큰) 적용

2. **관리자 프론트**
   - **로그인 화면**: 관리자 비밀번호 또는 계정으로 로그인
   - **이벤트 목록 화면**: 테이블로 표시, 상태·날짜 필터, "추가" 버튼
   - **이벤트 생성 화면**: 시나리오 선택(드롭다운), 시작/종료 일시, 리워드, 제한시간, 필요 티켓 입력 후 `POST /admin/events`
   - **이벤트 수정 화면**: 기존 값 불러온 뒤 수정하여 `PUT /admin/events/:id`
   - **삭제/비활성화**: 목록에서 버튼으로 `DELETE` 호출

3. **미니앱 연동**
   - 백엔드에서 **이벤트 목록 API** 제공 (예: `GET /events?date=2025-02-16` 또는 `GET /events?status=live,scheduled`)
   - **수정할 파일**: `js/api.js`에 `getEvents()` 등 이벤트 목록/상세 함수 추가 후, `js/app.js` 또는 `js/ui.js`에서 초기화 시 호출. 홈의 "오늘의 시나리오"·"다음 시나리오 예고" 영역을 **동적 렌더링**으로 전환 (현재는 `index.html` 하드코딩).
   - `js/ui.js`의 `startCountdowns()`를 이벤트별 `endAt`을 받아 각 카드 ID에 맞춰 타이머를 세팅하도록 변경.
   - 시나리오 메타(제목·배너·질문 수)는 계속 `js/data.js`의 `scenarios`를 참조하거나, 백엔드에서 시나리오 목록을 내려주면 그에 맞춰 표시.

---

## 5. 관리자 페이지 UI 구성 예시

- **상단**: "Human Experiment 관리자" 타이틀, 로그아웃
- **사이드/탭**: 이벤트 목록 | 이벤트 추가 (필요 시 나중에 "시나리오 관리" 추가)
- **이벤트 목록**
  - 컬럼: 이벤트명(시나리오), 시작일시, 종료일시, 리워드(USDT), 상태, [수정] [삭제]
  - 필터: 날짜 범위, 상태(예정/진행중/종료)
- **이벤트 추가/수정 폼**
  - 시나리오 선택 (현재: wedding / blind-date / bbq; `data.js`에 추가된 ID 확장 가능)
  - 시작 일시, 종료 일시 (datetime-local 또는 날짜+시간 입력)
  - 리워드(USDT), 플레이 제한시간(분), 필요 티켓, 문제 수
  - [저장] [취소]

---

## 6. 정리

| 항목 | 내용 |
|------|------|
| **필요한 것** | 백엔드 이벤트 CRUD API, 관리자 인증, 이벤트 목록/생성/수정/삭제 화면 |
| **데이터** | 이벤트 = 시나리오 ID + 시작/종료 일시 + 리워드·제한시간·티켓 등 |
| **구현 순서** | ① 백엔드 API + 인증 → ② 관리자 로그인·목록·폼 → ③ 미니앱이 이벤트 API 사용하도록 연동 |
| **보안** | 관리자 페이지는 별 URL/도메인, 반드시 인증 후 접근 |

### 6.1 미니앱 연동 시 수정·추가할 파일 요약

| 파일 | 변경 내용 |
|------|-----------|
| `js/api.js` | 이벤트 목록/상세 API 호출 함수 추가 (예: `getEvents()`, `getEvent(id)`) |
| `js/ui.js` | `startCountdowns()`를 이벤트별 `endAt` 기반으로 변경; 필요 시 홈 시나리오 카드 렌더링 함수 추가 |
| `index.html` 또는 JS 동적 생성 | "오늘의 시나리오"·"다음 시나리오 예고"를 API 응답으로 동적 생성 (선택: 템플릿을 JS에서 생성하거나, 빈 컨테이너만 두고 채우기) |
| `js/data.js` | 변경 없이 시나리오 메타·질문 유지 가능; 또는 백엔드에서 시나리오 목록 제공 시 그에 맞춰 연동 |

이 가이드를 기준으로 먼저 **백엔드 API**를 만들지, **관리자용 HTML/JS 초안**을 만들지 정한 뒤, 필요한 부분(예: API 스펙, 샘플 HTML)을 더 구체적으로 작성할 수 있습니다.
